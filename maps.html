<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confluence Map | Global Movement Research</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 3rem;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        
        .leaflet-popup-content {
            margin: 12px 16px;
        }
        
        .popup-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .popup-location {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        
        .popup-dances {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .popup-link {
            display: inline-block;
            margin-top: 8px;
            color: var(--earth);
            font-size: 0.85rem;
            text-decoration: none;
        }
        
        .popup-link:hover {
            text-decoration: underline;
        }
        
        /* Legend */
        .map-legend {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--surface);
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-marker.west-africa { background: #8b5e3c; }
        .legend-marker.caribbean { background: #2874a6; }
        .legend-marker.south-asia { background: #8b4513; }
        .legend-marker.europe { background: #228b22; }
        .legend-marker.americas { background: #c0392b; }
        
        /* Confluences Section */
        .confluences-section {
            margin-top: 3rem;
        }
        
        .section-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--earth);
        }
        
        .confluence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .confluence-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .confluence-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .confluence-header {
            padding: 1.25rem 1.5rem;
            color: white;
        }
        
        .confluence-header.west-africa { background: linear-gradient(135deg, #8b5e3c 0%, #5d3a1a 100%); }
        .confluence-header.caribbean { background: linear-gradient(135deg, #2874a6 0%, #1a5276 100%); }
        .confluence-header.south-asia { background: linear-gradient(135deg, #8b4513 0%, #5d2e0c 100%); }
        .confluence-header.europe { background: linear-gradient(135deg, #228b22 0%, #145214 100%); }
        .confluence-header.americas { background: linear-gradient(135deg, #c0392b 0%, #922b21 100%); }
        
        .confluence-name {
            font-family: var(--font-display);
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        .confluence-location {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .confluence-body {
            padding: 1.5rem;
        }
        
        .confluence-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .meta-item strong {
            color: var(--text-secondary);
        }
        
        .confluence-narrative {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .confluence-lineages {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .lineage-tag {
            padding: 0.25rem 0.75rem;
            background: var(--surface);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .confluence-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .confluence-link {
            padding: 0.5rem 1rem;
            background: var(--earth);
            color: white;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.8rem;
            transition: background 0.2s ease;
        }
        
        .confluence-link:hover {
            background: #6b4423;
        }
        
        /* Intro text */
        .map-intro {
            max-width: 800px;
            margin: 0 auto 2rem;
            text-align: center;
        }
        
        .map-intro p {
            color: var(--text-secondary);
            font-size: 1.0625rem;
            line-height: 1.7;
        }
        
        @media (max-width: 768px) {
            .map-container {
                height: 400px;
            }
            
            .confluence-grid {
                grid-template-columns: 1fr;
            }
            
            .map-legend {
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">GMR</a>
            <ul class="nav-links">
                <li><a href="maps.html" class="active">Map</a></li>
                <li><a href="dances.html">Dances</a></li>
                <li><a href="compare.html">Compare</a></li>
                <li><a href="methods.html">Methods</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <header class="page-header">
                <h1>Confluence Map</h1>
                <p class="subtitle">Research sites across four continents</p>
            </header>
            
            <div class="map-intro">
                <p>Global Movement Research uses Atomic Confluences to describe regions where dance, migration, trade, and cultural memory cluster into dense movement ecologies. Each marker represents an active research site where motion capture data has been collected.</p>
            </div>
            
            <div class="map-legend">
                <div class="legend-item">
                    <span class="legend-marker west-africa"></span>
                    <span>West Africa</span>
                </div>
                <div class="legend-item">
                    <span class="legend-marker caribbean"></span>
                    <span>Caribbean</span>
                </div>
                <div class="legend-item">
                    <span class="legend-marker south-asia"></span>
                    <span>South Asia</span>
                </div>
                <div class="legend-item">
                    <span class="legend-marker europe"></span>
                    <span>Europe</span>
                </div>
                <div class="legend-item">
                    <span class="legend-marker americas"></span>
                    <span>Americas</span>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
            </div>

            <section class="confluences-section">
                <h2 class="section-title">Active Research Confluences</h2>
                <div class="confluence-grid" id="confluenceGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>Global Movement Research</h4>
                    <p>Documenting human movement heritage through ethical motion capture and open archives.</p>
                </div>
                <div class="footer-section">
                    <h4>Archive</h4>
                    <ul>
                        <li><a href="maps.html">Confluence Map</a></li>
                        <li><a href="dances.html">Dance Visualizations</a></li>
                        <li><a href="compare.html">Comparison Tool</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="methods.html">Methods</a></li>
                        <li><a href="docs/aei-canonical-first-steps.html">AEI Documentation</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Global Movement Research</p>
                <p>Sinclair Emoghene, Researcher</p>
                <p>University of Texas at Austin | Sinclair Dance | StepMate</p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Region colors
        const regionColors = {
            'West Africa': '#8b5e3c',
            'Caribbean': '#2874a6',
            'South Asia': '#8b4513',
            'Europe': '#228b22',
            'Americas': '#c0392b'
        };
        
        // Initialize map
        const map = L.map('map').setView([20, 0], 2);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
        
        // Fetch and display confluences
        fetch('data/confluences.json')
            .then(response => response.json())
            .then(data => {
                const confluences = data.confluences;
                const grid = document.getElementById('confluenceGrid');
                
                confluences.forEach(conf => {
                    // Create marker
                    const color = regionColors[conf.region] || '#8b5e3c';
                    
                    const marker = L.circleMarker([conf.coordinates[0], conf.coordinates[1]], {
                        radius: 10,
                        fillColor: color,
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                    
                    // Popup content
                    const popupContent = `
                        <div class="popup-title">${conf.name}</div>
                        <div class="popup-location">${conf.location}</div>
                        <div class="popup-dances">${conf.danceCount} dances captured</div>
                        <a href="#${conf.id}" class="popup-link">View details below â†“</a>
                    `;
                    marker.bindPopup(popupContent);
                    
                    // Create card
                    const regionClass = conf.region.toLowerCase().replace(' ', '-');
                    const linksHTML = conf.links.map(link => 
                        `<a href="${link.url}" class="confluence-link">${link.label}</a>`
                    ).join('');
                    
                    const lineagesHTML = conf.lineages.map(l => 
                        `<span class="lineage-tag">${l}</span>`
                    ).join('');
                    
                    const card = document.createElement('div');
                    card.className = 'confluence-card';
                    card.id = conf.id;
                    card.innerHTML = `
                        <div class="confluence-header ${regionClass}">
                            <div class="confluence-name">${conf.name}</div>
                            <div class="confluence-location">${conf.location}</div>
                        </div>
                        <div class="confluence-body">
                            <div class="confluence-meta">
                                <span class="meta-item"><strong>${conf.danceCount}</strong> dances</span>
                                <span class="meta-item">Performer: <strong>${conf.performer}</strong></span>
                            </div>
                            <div class="confluence-lineages">${lineagesHTML}</div>
                            <p class="confluence-narrative">${conf.narrative}</p>
                            <div class="confluence-links">${linksHTML}</div>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            });
        
        // Nav scroll effect
        const nav = document.querySelector('.nav');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });
    </script>
</body>
</html>
